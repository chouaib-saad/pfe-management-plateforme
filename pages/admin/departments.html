<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Départements - PFE Platform</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="../../css/design-system.css">
    <link rel="stylesheet" href="../../css/components.css">
    <link rel="stylesheet" href="../../css/animations.css">
    <link rel="stylesheet" href="../../css/buttons.css">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        .department-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .department-card {
            background-color: var(--bg-secondary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .department-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .department-header {
            padding: 1.5rem;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-blue-dark));
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .department-title {
            font-size: 1.25rem;
            font-weight: var(--font-weight-semibold);
            margin: 0;
        }
        
        .department-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .department-action {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .department-action:hover {
            background-color: rgba(255, 255, 255, 0.3);
        }
        
        .department-body {
            padding: 1.5rem;
        }
        
        .department-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .department-stat {
            background-color: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 1rem;
            text-align: center;
        }
        
        .department-stat-value {
            font-size: 1.5rem;
            font-weight: var(--font-weight-bold);
            margin-bottom: 0.25rem;
        }
        
        .department-stat-label {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }
        
        .department-chart {
            height: 200px;
            margin-bottom: 1rem;
        }
        
        .department-info {
            display: flex;
            align-items: center;
            margin-bottom: 0.5rem;
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }
        
        .department-info i {
            margin-right: 0.5rem;
            width: 16px;
            text-align: center;
        }
        
        .department-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            background-color: var(--bg-secondary);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }
        
        .department-table th, .department-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .department-table th {
            background-color: var(--bg-tertiary);
            font-weight: var(--font-weight-semibold);
            color: var(--text-primary);
        }
        
        .department-table tr:last-child td {
            border-bottom: none;
        }
        
        .department-table tr:hover {
            background-color: var(--bg-hover);
        }
        
        .department-status {
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: var(--font-size-xs);
            font-weight: var(--font-weight-medium);
        }
        
        .department-status.active {
            background-color: rgba(52, 199, 89, 0.1);
            color: var(--success-color);
        }
        
        .department-status.inactive {
            background-color: rgba(255, 69, 58, 0.1);
            color: var(--danger-color);
        }
        
        .department-filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .department-filter {
            display: flex;
            align-items: center;
        }
        
        .department-filter label {
            margin-right: 0.5rem;
            font-weight: var(--font-weight-medium);
        }
        
        .department-filter select {
            padding: 0.5rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            outline: none;
        }
        
        .department-filter select:focus {
            border-color: var(--primary-blue);
        }
        
        .department-actions-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            width: 100%;
            max-width: 500px;
            background-color: var(--bg-primary);
            border-radius: var(--radius-lg);
            overflow: hidden;
            transform: scale(0.9);
            transition: transform 0.3s;
        }
        
        .modal.active .modal-content {
            transform: scale(1);
        }
        
        .modal-header {
            padding: 1rem;
            background-color: var(--bg-secondary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.25rem;
            font-weight: var(--font-weight-semibold);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.25rem;
            cursor: pointer;
            color: var(--text-primary);
        }
        
        .modal-body {
            padding: 1rem;
        }
        
        .modal-footer {
            padding: 1rem;
            background-color: var(--bg-secondary);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: var(--font-weight-medium);
        }
        
        .form-control {
            width: 100%;
            padding: 0.75rem;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            outline: none;
        }
        
        .form-control:focus {
            border-color: var(--primary-blue);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            margin-bottom: 2rem;
        }
    </style>
</head>
<body>
      <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <a href="../../index.html" class="sidebar-brand">
                <img src="https://www.issatso.rnu.tn/wp-content/uploads/2021/01/issat-so-logo.png" alt="ISSAT Logo">
                <span>PFE Platform</span>
            </a>
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
        </div>
        
        <ul class="sidebar-nav">
            <li class="sidebar-item">
                <a href="dashboard.html" class="sidebar-link active">
                    <i class="fas fa-tachometer-alt sidebar-icon"></i>
                    <span class="sidebar-text">Tableau de bord</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="users.html" class="sidebar-link">
                    <i class="fas fa-users sidebar-icon"></i>
                    <span class="sidebar-text">Utilisateurs</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="departments.html" class="sidebar-link">
                    <i class="fas fa-building sidebar-icon"></i>
                    <span class="sidebar-text">Départements</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="teachers.html" class="sidebar-link">
                    <i class="fas fa-chalkboard-teacher sidebar-icon"></i>
                    <span class="sidebar-text">Enseignants</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="pfe-management.html" class="sidebar-link">
                    <i class="fas fa-tasks sidebar-icon"></i>
                    <span class="sidebar-text">Gestion des PFEs</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="settings.html" class="sidebar-link">
                    <i class="fas fa-cog sidebar-icon"></i>
                    <span class="sidebar-text">Paramètres</span>
                </a>
            </li>
            <li class="sidebar-item">
                <a href="../../index.html" class="sidebar-link">
                    <i class="fas fa-sign-out-alt sidebar-icon"></i>
                    <span class="sidebar-text">Déconnexion</span>
                </a>
            </li>
        </ul>
    </div>
    <!-- Main Content -->
    <main class="main-content">
        <header class="header">
            <div class="header-left">
                <button class="sidebar-toggle">
                    <i class="fas fa-bars"></i>
                </button>
                
                <div class="InputContainer">
                  <input type="text" name="text" class="input" id="input" placeholder="Rechercher...">
                  
                  <label for="input" class="labelforsearch">
                    <svg viewBox="0 0 512 512" class="searchIcon"><path d="M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"></path></svg>
                  </label>
                  <div class="border"></div>
                
                  <button class="micButton"><svg viewBox="0 0 384 512" class="micIcon"><path d="M192 0C139 0 96 43 96 96V256c0 53 43 96 96 96s96-43 96-96V96c0-53-43-96-96-96zM64 216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 89.1 66.2 162.7 152 174.4V464H120c-13.3 0-24 10.7-24 24s10.7 24 24 24h72 72c13.3 0 24-10.7 24-24s-10.7-24-24-24H216V430.4c85.8-11.7 152-85.3 152-174.4V216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 70.7-57.3 128-128 128s-128-57.3-128-128V216z"></path></svg>
                  </button>
                </div>
            </div>
            
            <div class="header-right">
                <div class="header-notification">
                    <i class="fas fa-bell"></i>
                    <span class="header-notification-count">3</span>
                </div>
                
                <div class="header-user">
                    <img src="https://ui-avatars.com/api/?name=Admin&background=0D8ABC&color=fff" alt="Admin" class="header-user-avatar">
                    <div class="header-user-info">
                        <div class="header-user-name">Admin</div>
                        <div class="header-user-role">Administrateur</div>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="content">
            <div class="content-header">
                <h1 class="content-title">Gestion des Départements</h1>
                <div class="content-breadcrumb">
                    <a href="dashboard.html">Tableau de bord</a>
                    <i class="fas fa-chevron-right"></i>
                    <span>Départements</span>
                </div>
            </div>
            
            <div class="card">
                <div class="card-body">
                    <div class="department-actions-top">
                        <div class="department-filters">
                            <div class="department-filter">
                                <label for="statusFilter">Statut:</label>
                                <select id="statusFilter">
                                    <option value="all">Tous</option>
                                    <option value="active">Actif</option>
                                    <option value="inactive">Inactif</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="department-actions-buttons">
                            <button class="btn btn-primary" id="addDepartmentBtn">
                                <i class="fas fa-plus mr-2"></i>Ajouter un département
                            </button>
                            
                            <button class="btn btn-outline" id="refreshBtn">
                                <i class="fas fa-sync-alt mr-2"></i>Actualiser
                            </button>
                        </div>
                    </div>
                    
                    <div class="chart-container">
                        <canvas id="departmentsChart"></canvas>
                    </div>
                    
                    <div class="department-grid">
                        <div class="department-card">
                            <div class="department-header">
                                <h3 class="department-title">Informatique</h3>
                                <div class="department-actions">
                                    <div class="department-action edit" data-id="1">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="department-action delete" data-id="1">
                                        <i class="fas fa-trash-alt"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="department-body">
                                <div class="department-stats">
                                    <div class="department-stat">
                                        <div class="department-stat-value">42</div>
                                        <div class="department-stat-label">PFE</div>
                                    </div>
                                    <div class="department-stat">
                                        <div class="department-stat-value">15</div>
                                        <div class="department-stat-label">Enseignants</div>
                                    </div>
                                </div>
                                <div class="department-chart">
                                    <canvas id="chart1"></canvas>
                                </div>
                                <div class="department-info">
                                    <i class="fas fa-user"></i>
                                    <span>Chef: Dr. Nadia Alaoui</span>
                                </div>
                                <div class="department-info">
                                    <i class="fas fa-envelope"></i>
                                    <span>n.alaoui@exemple.com</span>
                                </div>
                                <div class="department-info">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>Créé le: 15/09/2024</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="department-card">
                            <div class="department-header">
                                <h3 class="department-title">Électronique</h3>
                                <div class="department-actions">
                                    <div class="department-action edit" data-id="2">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="department-action delete" data-id="2">
                                        <i class="fas fa-trash-alt"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="department-body">
                                <div class="department-stats">
                                    <div class="department-stat">
                                        <div class="department-stat-value">35</div>
                                        <div class="department-stat-label">PFE</div>
                                    </div>
                                    <div class="department-stat">
                                        <div class="department-stat-value">12</div>
                                        <div class="department-stat-label">Enseignants</div>
                                    </div>
                                </div>
                                <div class="department-chart">
                                    <canvas id="chart2"></canvas>
                                </div>
                                <div class="department-info">
                                    <i class="fas fa-user"></i>
                                    <span>Chef: Dr. Mohamed Karim</span>
                                </div>
                                <div class="department-info">
                                    <i class="fas fa-envelope"></i>
                                    <span>m.karim@exemple.com</span>
                                </div>
                                <div class="department-info">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>Créé le: 15/09/2024</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="department-card">
                            <div class="department-header">
                                <h3 class="department-title">Mécanique</h3>
                                <div class="department-actions">
                                    <div class="department-action edit" data-id="3">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="department-action delete" data-id="3">
                                        <i class="fas fa-trash-alt"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="department-body">
                                <div class="department-stats">
                                    <div class="department-stat">
                                        <div class="department-stat-value">28</div>
                                        <div class="department-stat-label">PFE</div>
                                    </div>
                                    <div class="department-stat">
                                        <div class="department-stat-value">10</div>
                                        <div class="department-stat-label">Enseignants</div>
                                    </div>
                                </div>
                                <div class="department-chart">
                                    <canvas id="chart3"></canvas>
                                </div>
                                <div class="department-info">
                                    <i class="fas fa-user"></i>
                                    <span>Chef: Dr. Omar Tazi</span>
                                </div>
                                <div class="department-info">
                                    <i class="fas fa-envelope"></i>
                                    <span>o.tazi@exemple.com</span>
                                </div>
                                <div class="department-info">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>Créé le: 15/09/2024</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="department-card">
                            <div class="department-header">
                                <h3 class="department-title">Génie Électrique</h3>
                                <div class="department-actions">
                                    <div class="department-action edit" data-id="4">
                                        <i class="fas fa-edit"></i>
                                    </div>
                                    <div class="department-action delete" data-id="4">
                                        <i class="fas fa-trash-alt"></i>
                                    </div>
                                </div>
                            </div>
                            <div class="department-body">
                                <div class="department-stats">
                                    <div class="department-stat">
                                        <div class="department-stat-value">20</div>
                                        <div class="department-stat-label">PFE</div>
                                    </div>
                                    <div class="department-stat">
                                        <div class="department-stat-value">8</div>
                                        <div class="department-stat-label">Enseignants</div>
                                    </div>
                                </div>
                                <div class="department-chart">
                                    <canvas id="chart4"></canvas>
                                </div>
                                <div class="department-info">
                                    <i class="fas fa-user"></i>
                                    <span>Chef: Dr. Laila Mansouri</span>
                                </div>
                                <div class="department-info">
                                    <i class="fas fa-envelope"></i>
                                    <span>l.mansouri@exemple.com</span>
                                </div>
                                <div class="department-info">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>Créé le: 18/04/2025</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
    
    <!-- Add/Edit Department Modal -->
    <div class="modal" id="departmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Ajouter un département</h3>
                <button class="modal-close" id="modalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="departmentForm">
                    <input type="hidden" id="departmentId" value="">
                    
                    <div class="form-group">
                        <label for="departmentName">Nom du département</label>
                        <input type="text" id="departmentName" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="departmentHead">Chef de département</label>
                        <select id="departmentHead" class="form-control" required>
                            <option value="">Sélectionner un chef</option>
                            <option value="1">Dr. Nadia Alaoui</option>
                            <option value="2">Dr. Mohamed Karim</option>
                            <option value="3">Dr. Omar Tazi</option>
                            <option value="4">Dr. Laila Mansouri</option>
                            <option value="5">Dr. Kamal Hassan</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="departmentEmail">Email du département</label>
                        <input type="email" id="departmentEmail" class="form-control" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="departmentStatus">Statut</label>
                        <select id="departmentStatus" class="form-control" required>
                            <option value="">Sélectionner un statut</option>
                            <option value="active">Actif</option>
                            <option value="inactive">Inactif</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="departmentDescription">Description</label>
                        <textarea id="departmentDescription" class="form-control" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelBtn">Annuler</button>
                <button class="btn btn-primary" id="saveDepartmentBtn">Enregistrer</button>
            </div>
        </div>
    </div>
    
    <!-- Delete Confirmation Modal -->
    <div class="modal" id="deleteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Confirmer la suppression</h3>
                <button class="modal-close" id="deleteModalClose">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Êtes-vous sûr de vouloir supprimer ce département ? Cette action est irréversible et supprimera également tous les PFE associés.</p>
                <input type="hidden" id="deleteDepartmentId" value="">
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="cancelDeleteBtn">Annuler</button>
                <button class="btn btn-danger" id="confirmDeleteBtn">Supprimer</button>
            </div>
        </div>
    </div>
    
    <!-- Chatbot -->
    <div class="chatbot-toggle" id="chatbotToggle">
        <i class="fas fa-comment-dots"></i>
    </div>
    
    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
            <div class="chatbot-title">
                <i class="fas fa-robot mr-2"></i>
                Assistant PFE
            </div>
            <button class="chatbot-close" id="chatbotClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="chatbot-body" id="chatbotBody">
            <div class="chatbot-message bot">
                Bonjour ! Je suis l'assistant virtuel de la plateforme PFE. Comment puis-je vous aider aujourd'hui ?
                
                <div class="chatbot-suggestions">
                    <div class="chatbot-suggestion">Comment ajouter un département ?</div>
                    <div class="chatbot-suggestion">Comment voir les statistiques ?</div>
                    <div class="chatbot-suggestion">Comment gérer les PFE par département ?</div>
                </div>
            </div>
        </div>
        
        <div class="chatbot-footer">
            <div class="chatbot-input-container">
                <input type="text" class="chatbot-input" placeholder="Tapez votre message..." id="chatbotInput">
                <button class="chatbot-send" id="chatbotSend">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Sidebar Toggle
        const sidebarToggle = document.querySelector('.sidebar-toggle');
        const sidebar = document.querySelector('.sidebar');
        const mainContent = document.querySelector('.main-content');
        
        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        });
        
        // Department Modal
        const departmentModal = document.getElementById('departmentModal');
        const modalClose = document.getElementById('modalClose');
        const addDepartmentBtn = document.getElementById('addDepartmentBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const saveDepartmentBtn = document.getElementById('saveDepartmentBtn');
        const modalTitle = document.getElementById('modalTitle');
        const departmentForm = document.getElementById('departmentForm');
        const departmentId = document.getElementById('departmentId');
        const departmentName = document.getElementById('departmentName');
        const departmentHead = document.getElementById('departmentHead');
        const departmentEmail = document.getElementById('departmentEmail');
        const departmentStatus = document.getElementById('departmentStatus');
        const departmentDescription = document.getElementById('departmentDescription');
        
        // Edit Department
        const editButtons = document.querySelectorAll('.department-action.edit');
        
        editButtons.forEach(button => {
            button.addEventListener('click', () => {
                const id = button.getAttribute('data-id');
                modalTitle.textContent = 'Modifier un département';
                departmentId.value = id;
                
                // Get department data (in a real app, this would be an API call)
                const card = button.closest('.department-card');
                const name = card.querySelector('.department-title').textContent;
                const head = card.querySelector('.department-info:nth-child(4) span').textContent.replace('Chef: ', '');
                const email = card.querySelector('.department-info:nth-child(5) span').textContent;
                
                departmentName.value = name;
                departmentEmail.value = email;
                
                // Set head
                if (head === 'Dr. Nadia Alaoui') {
                    departmentHead.value = '1';
                } else if (head === 'Dr. Mohamed Karim') {
                    departmentHead.value = '2';
                } else if (head === 'Dr. Omar Tazi') {
                    departmentHead.value = '3';
                } else if (head === 'Dr. Laila Mansouri') {
                    departmentHead.value = '4';
                } else if (head === 'Dr. Kamal Hassan') {
                    departmentHead.value = '5';
                }
                
                // Set status (assuming all are active for this example)
                departmentStatus.value = 'active';
                
                // Set description (placeholder)
                departmentDescription.value = 'Description du département ' + name;
                
                departmentModal.classList.add('active');
            });
        });
        
        // Add Department
        addDepartmentBtn.addEventListener('click', () => {
            modalTitle.textContent = 'Ajouter un département';
            departmentId.value = '';
            departmentForm.reset();
            
            departmentModal.classList.add('active');
        });
        
        // Close Modal
        modalClose.addEventListener('click', () => {
            departmentModal.classList.remove('active');
        });
        
        cancelBtn.addEventListener('click', () => {
            departmentModal.classList.remove('active');
        });
        
        // Save Department
        saveDepartmentBtn.addEventListener('click', () => {
            // Validate form
            if (!departmentForm.checkValidity()) {
                departmentForm.reportValidity();
                return;
            }
            
            // In a real app, this would be an API call
            if (departmentId.value) {
                // Update existing department
                const card = document.querySelector(`.department-action.edit[data-id="${departmentId.value}"]`).closest('.department-card');
                
                card.querySelector('.department-title').textContent = departmentName.value;
                
                // Update head
                let headName = '';
                if (departmentHead.value === '1') {
                    headName = 'Dr. Nadia Alaoui';
                } else if (departmentHead.value === '2') {
                    headName = 'Dr. Mohamed Karim';
                } else if (departmentHead.value === '3') {
                    headName = 'Dr. Omar Tazi';
                } else if (departmentHead.value === '4') {
                    headName = 'Dr. Laila Mansouri';
                } else if (departmentHead.value === '5') {
                    headName = 'Dr. Kamal Hassan';
                }
                
                card.querySelector('.department-info:nth-child(4) span').textContent = 'Chef: ' + headName;
                card.querySelector('.department-info:nth-child(5) span').textContent = departmentEmail.value;
                
                alert('Département modifié avec succès !');
            } else {
                // Add new department
                const departmentGrid = document.querySelector('.department-grid');
                const newCard = document.createElement('div');
                newCard.className = 'department-card';
                
                // Get head name
                let headName = '';
                if (departmentHead.value === '1') {
                    headName = 'Dr. Nadia Alaoui';
                } else if (departmentHead.value === '2') {
                    headName = 'Dr. Mohamed Karim';
                } else if (departmentHead.value === '3') {
                    headName = 'Dr. Omar Tazi';
                } else if (departmentHead.value === '4') {
                    headName = 'Dr. Laila Mansouri';
                } else if (departmentHead.value === '5') {
                    headName = 'Dr. Kamal Hassan';
                }
                
                // Create new card HTML
                newCard.innerHTML = `
                    <div class="department-header">
                        <h3 class="department-title">${departmentName.value}</h3>
                        <div class="department-actions">
                            <div class="department-action edit" data-id="5">
                                <i class="fas fa-edit"></i>
                            </div>
                            <div class="department-action delete" data-id="5">
                                <i class="fas fa-trash-alt"></i>
                            </div>
                        </div>
                    </div>
                    <div class="department-body">
                        <div class="department-stats">
                            <div class="department-stat">
                                <div class="department-stat-value">0</div>
                                <div class="department-stat-label">PFE</div>
                            </div>
                            <div class="department-stat">
                                <div class="department-stat-value">0</div>
                                <div class="department-stat-label">Enseignants</div>
                            </div>
                        </div>
                        <div class="department-chart">
                            <canvas id="chart5"></canvas>
                        </div>
                        <div class="department-info">
                            <i class="fas fa-user"></i>
                            <span>Chef: ${headName}</span>
                        </div>
                        <div class="department-info">
                            <i class="fas fa-envelope"></i>
                            <span>${departmentEmail.value}</span>
                        </div>
                        <div class="department-info">
                            <i class="fas fa-calendar-alt"></i>
                            <span>Créé le: ${new Date().toLocaleDateString('fr-FR')}</span>
                        </div>
                    </div>
                `;
                
                // Append new card
                departmentGrid.appendChild(newCard);
                
                // Initialize chart for new card
                const newChartCanvas = newCard.querySelector('canvas');
                new Chart(newChartCanvas, {
                    type: 'doughnut',
                    data: {
                        labels: ['En cours', 'Terminés', 'À venir'],
                        datasets: [{
                            data: [0, 0, 0],
                            backgroundColor: [
                                'rgba(255, 149, 0, 0.7)',
                                'rgba(52, 199, 89, 0.7)',
                                'rgba(0, 122, 255, 0.7)'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
                
                // Add event listeners to new buttons
                const newEditButton = newCard.querySelector('.department-action.edit');
                const newDeleteButton = newCard.querySelector('.department-action.delete');
                
                newEditButton.addEventListener('click', () => {
                    const id = newEditButton.getAttribute('data-id');
                    modalTitle.textContent = 'Modifier un département';
                    departmentId.value = id;
                    
                    // Get department data
                    const card = newEditButton.closest('.department-card');
                    const name = card.querySelector('.department-title').textContent;
                    const head = card.querySelector('.department-info:nth-child(4) span').textContent.replace('Chef: ', '');
                    const email = card.querySelector('.department-info:nth-child(5) span').textContent;
                    
                    departmentName.value = name;
                    departmentEmail.value = email;
                    
                    // Set head
                    if (head === 'Dr. Nadia Alaoui') {
                        departmentHead.value = '1';
                    } else if (head === 'Dr. Mohamed Karim') {
                        departmentHead.value = '2';
                    } else if (head === 'Dr. Omar Tazi') {
                        departmentHead.value = '3';
                    } else if (head === 'Dr. Laila Mansouri') {
                        departmentHead.value = '4';
                    } else if (head === 'Dr. Kamal Hassan') {
                        departmentHead.value = '5';
                    }
                    
                    // Set status (assuming all are active for this example)
                    departmentStatus.value = 'active';
                    
                    // Set description (placeholder)
                    departmentDescription.value = 'Description du département ' + name;
                    
                    departmentModal.classList.add('active');
                });
                
                newDeleteButton.addEventListener('click', () => {
                    const id = newDeleteButton.getAttribute('data-id');
                    deleteDepartmentId.value = id;
                    deleteModal.classList.add('active');
                });
                
                // Update main chart
                updateMainChart();
                
                alert('Département ajouté avec succès !');
            }
            
            departmentModal.classList.remove('active');
        });
        
        // Delete Department
        const deleteModal = document.getElementById('deleteModal');
        const deleteModalClose = document.getElementById('deleteModalClose');
        const cancelDeleteBtn = document.getElementById('cancelDeleteBtn');
        const confirmDeleteBtn = document.getElementById('confirmDeleteBtn');
        const deleteDepartmentId = document.getElementById('deleteDepartmentId');
        const deleteButtons = document.querySelectorAll('.department-action.delete');
        
        deleteButtons.forEach(button => {
            button.addEventListener('click', () => {
                const id = button.getAttribute('data-id');
                deleteDepartmentId.value = id;
                deleteModal.classList.add('active');
            });
        });
        
        deleteModalClose.addEventListener('click', () => {
            deleteModal.classList.remove('active');
        });
        
        cancelDeleteBtn.addEventListener('click', () => {
            deleteModal.classList.remove('active');
        });
        
        confirmDeleteBtn.addEventListener('click', () => {
            // In a real app, this would be an API call
            const card = document.querySelector(`.department-action.delete[data-id="${deleteDepartmentId.value}"]`).closest('.department-card');
            card.remove();
            
            // Update main chart
            updateMainChart();
            
            deleteModal.classList.remove('active');
            alert('Département supprimé avec succès !');
        });
        
        // Refresh Button
        const refreshBtn = document.getElementById('refreshBtn');
        
        refreshBtn.addEventListener('click', () => {
            // In a real app, this would refresh data from the server
            alert('Données actualisées !');
        });
        
        // Filters
        const statusFilter = document.getElementById('statusFilter');
        
        statusFilter.addEventListener('change', filterDepartments);
        
        function filterDepartments() {
            const statusValue = statusFilter.value;
            
            const cards = document.querySelectorAll('.department-card');
            
            cards.forEach(card => {
                let showCard = true;
                
                // Filter by status (assuming all are active for this example)
                if (statusValue !== 'all' && statusValue !== 'active') {
                    showCard = false;
                }
                
                // Show or hide card
                card.style.display = showCard ? '' : 'none';
            });
        }
        
        // Initialize Charts
        function initializeCharts() {
            // Department Charts
            const chartCanvases = document.querySelectorAll('.department-chart canvas');
            
            chartCanvases.forEach((canvas, index) => {
                // Generate random data for demonstration
                const data1 = Math.floor(Math.random() * 10) + 5;
                const data2 = Math.floor(Math.random() * 10) + 5;
                const data3 = Math.floor(Math.random() * 10) + 5;
                
                new Chart(canvas, {
                    type: 'doughnut',
                    data: {
                        labels: ['En cours', 'Terminés', 'À venir'],
                        datasets: [{
                            data: [data1, data2, data3],
                            backgroundColor: [
                                'rgba(255, 149, 0, 0.7)',
                                'rgba(52, 199, 89, 0.7)',
                                'rgba(0, 122, 255, 0.7)'
                            ],
                            borderWidth: 0
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            });
            
            // Main Chart
            updateMainChart();
        }
        
        function updateMainChart() {
            const ctx = document.getElementById('departmentsChart');
            
            // Get department names and PFE counts
            const departments = [];
            const pfeCounts = [];
            const teacherCounts = [];
            
            document.querySelectorAll('.department-card').forEach(card => {
                departments.push(card.querySelector('.department-title').textContent);
                pfeCounts.push(parseInt(card.querySelector('.department-stat:nth-child(1) .department-stat-value').textContent));
                teacherCounts.push(parseInt(card.querySelector('.department-stat:nth-child(2) .department-stat-value').textContent));
            });
            
            // Destroy existing chart if it exists
            if (window.mainChart) {
                window.mainChart.destroy();
            }
            
            // Create new chart
            window.mainChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: departments,
                    datasets: [
                        {
                            label: 'Nombre de PFE',
                            data: pfeCounts,
                            backgroundColor: 'rgba(0, 122, 255, 0.7)',
                            borderWidth: 0
                        },
                        {
                            label: 'Nombre d\'Enseignants',
                            data: teacherCounts,
                            backgroundColor: 'rgba(255, 149, 0, 0.7)',
                            borderWidth: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Statistiques par Département',
                            font: {
                                size: 16
                            }
                        }
                    }
                }
            });
        }
        
        // Initialize charts on page load
        document.addEventListener('DOMContentLoaded', initializeCharts);
        
        // Chatbot
        const chatbotToggle = document.getElementById('chatbotToggle');
        const chatbotContainer = document.getElementById('chatbotContainer');
        const chatbotClose = document.getElementById('chatbotClose');
        const chatbotBody = document.getElementById('chatbotBody');
        const chatbotInput = document.getElementById('chatbotInput');
        const chatbotSend = document.getElementById('chatbotSend');
        
        // Toggle chatbot
        chatbotToggle.addEventListener('click', () => {
            chatbotContainer.classList.add('active');
            chatbotToggle.style.display = 'none';
        });
        
        chatbotClose.addEventListener('click', () => {
            chatbotContainer.classList.remove('active');
            chatbotToggle.style.display = 'flex';
        });
        
        // Send message
        function sendMessage() {
            const message = chatbotInput.value.trim();
            
            if (message) {
                // Add user message
                const userMessage = document.createElement('div');
                userMessage.className = 'chatbot-message user';
                userMessage.textContent = message;
                chatbotBody.appendChild(userMessage);
                
                // Clear input
                chatbotInput.value = '';
                
                // Scroll to bottom
                chatbotBody.scrollTop = chatbotBody.scrollHeight;
                
                // Simulate bot response after a short delay
                setTimeout(() => {
                    let botResponse;
                    
                    // Simple response logic based on keywords
                    if (message.toLowerCase().includes('ajouter') || message.toLowerCase().includes('créer')) {
                        botResponse = "Pour ajouter un département, cliquez sur le bouton 'Ajouter un département' en haut à droite de la page. Remplissez ensuite le formulaire avec les informations du département et cliquez sur 'Enregistrer'.";
                    } else if (message.toLowerCase().includes('statistique') || message.toLowerCase().includes('graphique')) {
                        botResponse = "Les statistiques des départements sont affichées sous forme de graphiques. Le graphique principal en haut montre la comparaison entre les départements en termes de nombre de PFE et d'enseignants. Chaque carte de département contient également un graphique circulaire montrant la répartition des PFE par statut.";
                    } else if (message.toLowerCase().includes('pfe') || message.toLowerCase().includes('projet')) {
                        botResponse = "Pour gérer les PFE par département, vous pouvez accéder à la page 'Gestion des PFE' depuis le menu latéral. Vous pourrez y filtrer les PFE par département et voir les détails de chaque projet.";
                    } else {
                        botResponse = "Je ne suis pas sûr de comprendre votre question. Voici quelques sujets sur lesquels je peux vous aider :";
                        
                        // Add suggestions
                        const suggestions = document.createElement('div');
                        suggestions.className = 'chatbot-suggestions';
                        
                        const suggestion1 = document.createElement('div');
                        suggestion1.className = 'chatbot-suggestion';
                        suggestion1.textContent = "Comment ajouter un département ?";
                        
                        const suggestion2 = document.createElement('div');
                        suggestion2.className = 'chatbot-suggestion';
                        suggestion2.textContent = "Comment voir les statistiques ?";
                        
                        const suggestion3 = document.createElement('div');
                        suggestion3.className = 'chatbot-suggestion';
                        suggestion3.textContent = "Comment gérer les PFE par département ?";
                        
                        suggestions.appendChild(suggestion1);
                        suggestions.appendChild(suggestion2);
                        suggestions.appendChild(suggestion3);
                        
                        // Add bot response
                        const botMessage = document.createElement('div');
                        botMessage.className = 'chatbot-message bot';
                        botMessage.textContent = botResponse;
                        botMessage.appendChild(suggestions);
                        chatbotBody.appendChild(botMessage);
                        
                        // Add click event to suggestions
                        const allSuggestions = document.querySelectorAll('.chatbot-suggestion');
                        allSuggestions.forEach(suggestion => {
                            suggestion.addEventListener('click', () => {
                                chatbotInput.value = suggestion.textContent;
                                sendMessage();
                            });
                        });
                        
                        return;
                    }
                    
                    // Add bot response
                    const botMessage = document.createElement('div');
                    botMessage.className = 'chatbot-message bot';
                    botMessage.textContent = botResponse;
                    chatbotBody.appendChild(botMessage);
                    
                    // Scroll to bottom
                    chatbotBody.scrollTop = chatbotBody.scrollHeight;
                }, 1000);
            }
        }
        
        chatbotSend.addEventListener('click', sendMessage);
        
        chatbotInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        // Add click event to initial suggestions
        const initialSuggestions = document.querySelectorAll('.chatbot-suggestion');
        initialSuggestions.forEach(suggestion => {
            suggestion.addEventListener('click', () => {
                chatbotInput.value = suggestion.textContent;
                sendMessage();
            });
        });
        
        // Voice recognition for search
        const micButton = document.querySelector('.micButton');
        const searchInput = document.querySelector('.input');
        
        if (micButton && 'webkitSpeechRecognition' in window) {
            const recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.lang = 'fr-FR';
            
            micButton.addEventListener('click', () => {
                recognition.start();
                micButton.style.backgroundColor = 'rgb(255, 230, 230)';
            });
            
            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                searchInput.value = transcript;
                micButton.style.backgroundColor = 'transparent';
            };
            
            recognition.onend = () => {
                micButton.style.backgroundColor = 'transparent';
            };
        }
    </script>
</body>
</html>
